#!/usr/bin/env php
<?php
require dirname(__FILE__) . '/../vendor/autoload.php';

use Symfony\Component\Config\FileLocator;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\Definition;
use Symfony\Component\DependencyInjection\Loader\PhpFileLoader;

use Http\Adapter\Guzzle6\Client;
use Http\Client\HttpClient;

use Ubi\Deploy\Deploy;

$container = new ContainerBuilder();
$loader = new PhpFileLoader($container, new FileLocator(__DIR__ . '/../config'));

$definition = new Definition();
$definition->setAutowired(true);

$loader->registerClasses($definition, 'Ubi\\Deploy\\', __DIR__ . '/../src/');

$container->register(HttpClient::class, Client::class);
$container->getDefinition(Deploy::class)
    ->setPublic(true);
$container->compile();

return $container->get(Deploy::class)->run();