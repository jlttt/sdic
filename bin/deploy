#!/usr/bin/env php
<?php
require dirname(__FILE__) . '/../vendor/autoload.php';

use Symfony\Component\Config\FileLocator;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\Loader\PhpFileLoader;

use Ubi\Deploy\Deploy;
use Ubi\Deploy\Service\SlugFilter;
use Ubi\Deploy\Service\VersionFilter;

$container = new ContainerBuilder();
$loader = new PhpFileLoader($container, new FileLocator(__DIR__ . '/../config'));
$loader->load('config.php');
$loader->load('parameters.php');
$container->compile();

$deploy = $container->get(Deploy::class);
$deploy->addFilter($container->get(SlugFilter::class));
$deploy->addFilter($container->get(VersionFilter::class));
return $container->get(Deploy::class)->run();